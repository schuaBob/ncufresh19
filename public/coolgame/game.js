var music_text,BGmsound,reach,reach_conrainer,loading_text,rank_user_list,rank_background,rank_container,user,rank_name_text,rank_score_text,question_data,dolphin_container,dolphin_list,leave_container,question_end_container,correct_fish,sound_shape,game_time_image,sound,soundbutton,labbybutton_container,question_container,back_container,generate_bird,rule_container,question,question_text,generate_fish,generate_bubble,stage,questionboard,background,board_index,sea,question_time_text,question_time,question_timer,bucket,user_score,now_score,score_update_timer,score_board,catch_animal_container,harpoon_text,catch_animal_text,score_catch_animal_container,score_catch_animal_text,start_time_text,countdown_time,countdown_text,countdown_timer,fisherman,t_boatmove_left,t_boatmove_right,fisherman_harpoon,loader,fishman_walk,generate_fish_ad,fish_ad,score_board_text,game_score_text,soundcontrol={BGM:null,CATCH:null,key3:null},muted=!1,reach_close=!0,rule_close=!0,game_id="",now=0,stop=!1,question_time_count=0,leavebutton_source=new Array,question_num=[0,0,0],option=new Array,question_index_list=new Array,question_time_stop=!0,game_time=45,question_list=new Array,catch_animal_num=[0,0,0,0,0],score_catch_animal_num=[0,0,0,0,0],player_control=!1,b_left=!1,b_right=!1,times=0,catch_fish=new Array,font_family="微軟正黑體",harpoon_list=new Array,animal_list=new Array,bubble_list=new Array,background_source={},animalsource=new Array,canvas_width=800,canvas_height=500,canvas_seaheight=150,gamestart=!1;function arrayRemove(e,t){return e.filter(function(e){return e!=t})}createjs.Bitmap.prototype.getwidth=function(){return this.image.width*this.scaleX},createjs.Bitmap.prototype.getheight=function(){return this.image.height*this.scaleY};class Score_Text extends createjs.Text{constructor(e,t,a,n,i){super(e,t,a),this.regX=this.getMeasuredWidth()/2,this.regY=this.getMeasuredHeight()/2,this.x=n,this.y=i,this.alpha=1,stage.addChild(this),createjs.Tween.get(this).to({y:i-40,alpha:0},550).call(()=>{stage.removeChild(this)})}}class Question{constructor(e,t,a,n){this.question=t,this.answer=n,this.option=a,this.type=e}}class Button_Text_Orginal extends createjs.Container{constructor(e,t,a,n,i){super(),this.x=n,this.y=i,this.text=new createjs.Text(e,t,a),this.havermask=new createjs.Shape,this.havermask.graphics.beginFill("#34AEC7").drawRect(50,0,80,30),this.havermask.alpha=.01;var r=this.text.getMeasuredWidth();this.underline=new createjs.Shape,this.haver=new createjs.Bitmap(loader.getResult("haver")),this.haver.x=-5,this.haver.y=-2,this.haver.scale=.48,this.text.x=50,this.text.y=0,this.underline.graphics.s("#000000").mt(this.text.x,this.text.y+25).lt(this.text.x+r,this.text.y+25),this.havermask.addEventListener("mouseover",function(e){e.target.parent.havermask.cursor="pointer",e.target.parent.haver.visible=!0,e.target.parent.underline.visible=!0}),this.havermask.addEventListener("mouseout",function(e){e.target.parent.havermask.cursor="defult",e.target.parent.haver.visible=!1,e.target.parent.underline.visible=!1}),this.underline.visible=!1,this.haver.visible=!1,this.addChild(this.text),this.addChild(this.underline),this.addChild(this.havermask),this.addChild(this.haver)}}class Button_Text extends createjs.Container{constructor(e,t,a,n,i){super(),this.x=n,this.y=i,this.text=new createjs.Text(e,t,a),this.havermask=new createjs.Shape,this.havermask.graphics.beginFill("#34AEC7").drawRoundRect(37,-6,20*this.text.text.length+24,34,10),this.havermask.alpha=.01;var r=this.text.getMeasuredWidth();this.underline=new createjs.Shape,this.haver=new createjs.Bitmap(loader.getResult("haver")),this.haver_background=new createjs.Shape,this.haver_background.graphics.beginFill("#FFFFFF").drawRoundRect(37,-6,20*this.text.text.length+24,34,10),this.haver_background.alpha=.5,this.haver.x=-12,this.haver.y=-2,this.haver.scale=.48,this.text.x=50,this.text.y=0,this.underline.graphics.s("#000000").mt(this.text.x,this.text.y+25).lt(this.text.x+r,this.text.y+25),this.havermask.addEventListener("mouseover",function(e){rule_close&&(e.target.parent.havermask.cursor="pointer",e.target.parent.haver.visible=!0,e.target.parent.haver_background.alpha=.9)}),this.havermask.addEventListener("mouseout",function(e){rule_close&&(e.target.parent.havermask.cursor="defult",e.target.parent.haver.visible=!1,e.target.parent.haver_background.alpha=.4)}),this.underline.visible=!1,this.haver.visible=!1,this.addChild(this.haver_background),this.addChild(this.text),this.addChild(this.underline),this.addChild(this.havermask),this.addChild(this.haver)}}class Option extends createjs.Container{constructor(){super(),this.x=210,this.y=250,this.background=new createjs.Shape,this.havermask=new createjs.Shape,this.text=new createjs.Text("","Bold 17px "+font_family,"#000000"),this.addChild(this.background),this.addChild(this.text),this.addChild(this.havermask),this.text.y=8,this.text.x=12.5,this.background.visible=!1,this.background.alpha=.4,this.done=!1,this.havermask.alpha=.01,this.ans=!1,this.havermask.addEventListener("mousedown",function(e){e.target.parent.done||question_time_stop||(e.target.parent.ans?e.target.parent.correct():e.target.parent.wrong())}),this.havermask.addEventListener("mouseover",function(e){e.target.parent.havermask.cursor="pointer",e.target.parent.done||question_time_stop||(e.target.parent.background.visible=!0)}),this.havermask.addEventListener("mouseout",function(e){e.target.parent.done||question_time_stop||(e.target.parent.background.visible=!1)})}correct(){this.background.visible=!0,this.done=!0,this.background.graphics.clear().beginFill("green").drawRoundRect(0,0,162,33,10),ans_num--,0==ans_num&&(back_container.visible=!1,muted||createjs.Sound.play("correct"),(correct_fish=new fish(board_index,!1)).scale=.5,correct_fish.x=550,correct_fish.y=350,correct_fish.gotoAndStop("normal_die"),stage.addChild(correct_fish),createjs.Tween.get(correct_fish).to({y:bucket.y+10,x:bucket.x+bucket.getwidth()/2,scale:.18},500).call(()=>{stage.removeChild(correct_fish),user_score+=animalsource[board_index].score}),question_time_stop=!0,questionboard.gotoAndStop("correct"),new Score_Text("+"+animalsource[board_index].score,"bold 40px 微軟正黑體","#000000",canvas_width/2,canvas_height/2),createjs.Tween.get(questionboard).wait(1e3).call(()=>{questionboard.gotoAndStop("normal"),next_question()}))}wrong(){muted||createjs.Sound.play("wrong"),this.background.visible=!0,this.done=!0,this.background.graphics.clear().beginFill("red").drawRoundRect(0,0,162,33,10),show_correct()}setText(e,t){this.text.text=e,this.done=!1,this.visible=!0,this.background.visible=!1,this.background.graphics.clear(),this.havermask.graphics.clear(),this.havermask.graphics.beginFill("#696969").drawRoundRect(0,0,162,33,10),this.background.graphics.beginFill("#696969").drawRoundRect(0,0,162,33,10),this.ans=t}}class Animal extends createjs.Sprite{constructor(e,t){t?(super(animalsource[e].spritesheet,"special"),this.score=2*animalsource[e].score):(super(animalsource[e].spritesheet,"normal"),this.score=animalsource[e].score),this.special=t,this.animaltype=e,stage.addChildAt(this,3)}move(){getrandom(1e3)<5&&(this.dic*=-1,this.scaleX*=-1),1==this.dic?this.x+=this.speed:this.x-=this.speed}catch(){clearInterval(this.t_move),catch_fish.push(this),animal_list=arrayRemove(animal_list,this),this.gotoAndStop(1==this.special?"special_die":"normal_die"),gamestart&&(catch_animal_num[this.animaltype]+=1),0!=this.animaltype&&6!=this.animaltype?(muted||createjs.Sound.play("catchfish0"+this.animaltype),new Score_Text("+"+this.score,"bold 20px 微軟正黑體","#000000",this.x,this.y),user_score+=this.score):0==this.animaltype&&(muted||createjs.Sound.play("catchbird")),6==this.animaltype&&(muted||createjs.Sound.play("catchdolphin")),catech_animal_update()}}function show_correct(){for(question_time_stop=!0,back_container.visible=!1,i=0;i<5;i++)option[i].ans&&!option[i].done&&(option[i].background.visible=!0,option[i].done=!0,option[i].background.graphics.clear().beginFill("green").drawRoundRect(0,0,162,33,10));createjs.Tween.get(questionboard).wait(1e3).call(()=>{next_question()})}class harpoon extends createjs.Bitmap{constructor(){super(loader.getResult("harpoon")),this.moveable=!1,this.regX=this.getwidth()/2,this.regY=this.getheight()/2,this.scale=.16,this.revise_position(),stage.addChildAt(this,4)}revise_position(){this.x=fisherman.x+25*(fisherman.scaleX<0?1:-1),this.y=fisherman.y-5}move(e,t,a,n){this.moveable=!0,this.mx=e,this.my=t,this.mc=a,this.mv=n}checkboom(){var e=0;for(e=0;e<bubble_list.length;e++){var t=bubble_list[e].localToLocal(bubble_list[e].image.width/2,bubble_list[e].image.height/2,this);if(this.hitTest(t.x,t.y))return stage.removeChild(bubble_list[e]),this.moveable=!1,bubble_list=arrayRemove(bubble_list,bubble_list[e]),createjs.Tween.get(this).to({y:canvas_seaheight,rotation:0==getrandom(2)?90:-90},2e3),new Score_Text("-1","bold 25px 微軟正黑體","#000000",this.x+this.getwidth()/2,this.y+10),!0}for(e=0;e<animal_list.length;e++){t=this.localToLocal(this.image.width/2,this.image.height,animal_list[e]);if(gamestart&&animal_list[e].hitTest(t.x,t.y)){this.moveable=!1,harpoon_list=arrayRemove(harpoon_list,this),harpoon_update(),stage.removeChild(this);var a=animal_list[e];return createjs.Tween.get(a).to({y:canvas_seaheight,rotation:1==a.dic?180:-180},0==a.animaltype?500:2e3),animal_list[e].catch(),!0}}return!1}}class fish extends Animal{constructor(e,t){super(e,t),this.scale=.12,6==e&&(this.scale=.25),this.speed=2,this.alpha=1,this.dic=1,1==getrandom(2)?(this.x=-100,this.dic=1):(this.x=canvas_width+100,this.dic=-1,this.scaleX*=-1),this.width=animalsource[e].spritesheet.getFrame(animalsource[e].spritesheet.getAnimation(1==t?"special":"normal").frames[0]).rect.width,this.height=animalsource[e].spritesheet.getFrame(animalsource[e].spritesheet.getAnimation(1==t?"special":"normal").frames[0]).rect.height,this.y=getrandom(275)+canvas_seaheight+50}}class bird extends Animal{constructor(e,t){super(e,t),this.scale=.16,this.speed=4,this.alpha=.85,1==getrandom(2)?(this.x=-90,this.dic=1,this.scaleX*=-1):(this.x=canvas_width+90,this.dic=-1),this.y=getrandom(50)+25}}function mousemove(e){var t=stage.mouseX-fisherman_harpoon.x,a=stage.mouseY-fisherman_harpoon.y,n=-1;t<0&&(n=1);var i=Math.pow(t*t+a*a,.5),r=Math.acos(a/i);fisherman_harpoon.rotation=n*(180*r/Math.PI)}function mousedown(e){if(!(harpoon_list.length>=10)){var t=new harpoon;muted||createjs.Sound.play("shoot");var a=stage.mouseX-t.x,n=stage.mouseY-t.y,i=-1;a<0&&(i=1);var r=Math.pow(a*a+n*n,.5),o=Math.acos(n/r);t.rotation=i*(180*o/Math.PI),t.move(a,n,r,10),harpoon_list.push(t),harpoon_update()}}function harpoon_update(){harpoon_text.text="Harpoon:"+(10-harpoon_list.length)}function boatmove_left(){fisherman.x-fisherman.getwidth()/2<0||(fisherman.x-=2,fisherman_harpoon.x=fisherman.x-25,fisherman.scaleX*=fisherman.scaleX<0?-1:1,mousemove())}function boatmove_right(e){fisherman.x-fisherman.getwidth()/2>canvas_width||(clearInterval(e),fisherman.x+=2,fisherman_harpoon.x=fisherman.x+25,fisherman.scaleX*=fisherman.scaleX<0?1:-1,mousemove())}function keyDown(e){player_control&&(37==e.keyCode||65==e.keyCode?b_left||(t_boatmove_left=setInterval(boatmove_left,20),b_left=!0):39!=e.keyCode&&68!=e.keyCode||b_right||(t_boatmove_right=setInterval(boatmove_right,20),b_right=!0)),32==e.keyCode&&mousedown()}function getrandom(e){return Math.floor(Math.random()*e)}function geth(){$.ajax({url:"gethistory",method:"GET",error:e=>{console.log(e)},success:function(e){console.log(e)}})}function getuser(){$.ajax({url:"getuser",method:"GET",error:e=>{console.log(e)},success:function(e){user=e.user,reach=!(user.score_sum<77777)}})}function load_question_data(){$.ajax({url:"getquestion",method:"GET",dataType:"JSON",error:e=>{console.log(e)},success:function(e){question_data=e.result,load_question()}})}function create_bubble(){var e=new createjs.Bitmap(loader.getResult("bubble"+(getrandom(6)+1)));bubble_list.push(e),e.regX=e.image.width/2,e.regY=e.image.height/2,e.scaleX=e.scaleY=.1,e.y=500,e.x=now_x=getrandom(750)+25,stage.addChildAt(e,stage.numChildren-2),e.onload=(()=>{stage.update()});var t=getrandom(3)/10+.13;createjs.Tween.get(e).to({y:canvas_seaheight,scaleX:t,scaleY:t},getrandom(1500)+3500).call(()=>{stage.removeChild(e),bubble_list=arrayRemove(bubble_list,e)}),createjs.Tween.get(e).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x}).wait(getrandom(canvas_seaheight)).to({x:now_x-getrandom(30)-15},getrandom(200)+300).call(()=>{now_x=e.x})}function open_bubble(){generate_bubble=setInterval(()=>{stop||getrandom(10)<1&&create_bubble()},200)}function update(){stop||(harpoon_move(),harpoon_check(),fish_move()),stage.update()}function fish_move(){for(i=0,i=0;i<animal_list.length;i++){if(animal_list[i].x>canvas_width+100||animal_list[i].x<-100)return stage.removeChild(animal_list[i]),gamestart&&0!=animal_list[i].animaltype&&(animal_list[i].animaltype>2?question_num[2]++:question_num[animal_list[i].animaltype-1]++),void(animal_list=arrayRemove(animal_list,animal_list[i]));animal_list[i].move()}}function harpoon_check(){for(times++,i=0,i=0;i<harpoon_list.length;i++)if(harpoon_list[i].moveable){if(times%3==0&&harpoon_list[i].x+harpoon_list[i].getheight()/2<canvas_width&&harpoon_list[i].x+harpoon_list[i].getheight()/2>0&&harpoon_list[i].checkboom())return;harpoon_list[i].y>canvas_seaheight&&(harpoon_list[i].mv=500/harpoon_list[i].y*1.8,harpoon_list[i].y>400&&(harpoon_list[i].mv=500/harpoon_list[i].y*1.4)),(harpoon_list[i].y-harpoon_list[i].image.height*harpoon_list[i].scaleY/2>=canvas_height||harpoon_list[i].y+harpoon_list[i].image.height*harpoon_list[i].scaleY/2<=0||harpoon_list[i].x-harpoon_list[i].image.height*harpoon_list[i].scaleX/2>=canvas_width||harpoon_list[i].x+harpoon_list[i].image.height*harpoon_list[i].scaleX/2<=0)&&(this.moveable=!1,stage.removeChild(harpoon_list[i]),harpoon_list=arrayRemove(harpoon_list,harpoon_list[i]),harpoon_update(),i--)}}function harpoon_move(){for(i=0;i<harpoon_list.length;i++)harpoon_list[i].moveable&&(harpoon_list[i].x+=harpoon_list[i].mx*harpoon_list[i].mv/harpoon_list[i].mc,harpoon_list[i].y+=harpoon_list[i].my*harpoon_list[i].mv/harpoon_list[i].mc)}function open_fish(){generate_fish=setInterval(()=>{if(!stop)if(question_num[0]+question_num[1]+question_num[2]>0){if(rnd=getrandom(1500),rnd<600){var e,t;do{e=(t=getrandom(19))<3?0:t<9?1:2}while(question_num[e]<=0);gamestart&&question_num[e]--,rnd<120?animal_list.push(new fish(2==e?e+1+getrandom(2):e+1,!0)):animal_list.push(new fish(2==e?e+1+getrandom(2):e+1,!1))}}else catch_animal_num[1]+catch_animal_num[2]+catch_animal_num[3]+catch_animal_num[4]==question_list[0].length+question_list[1].length+question_list[2].length&&game_end()},200)}function open_bird(){generate_bird=setInterval(()=>{if(!stop){var e=getrandom(90);e<2?animal_list.push(new bird(0,!1)):e<3&&animal_list.push(new fish(6,!1))}},1e3)}function keyUp(e){player_control&&(37==e.keyCode||65==e.keyCode?(b_left=!1,clearInterval(t_boatmove_left)):39!=e.keyCode&&68!=e.keyCode||(b_right=!1,clearInterval(t_boatmove_right)))}var complete_file_num=0;function load_source(){stage=new createjs.Stage(document.getElementById("gameStage"));var e=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e?(alert("手機碰到水會壞掉所以不支援歐，雖然電腦碰到水也會壞掉，但是我只是想說，只能用電腦玩歐~啾咪"),window.location="/"):(window.addEventListener("click",resumeAudioContext),loading_text=new createjs.Text("0%","bold 30px 微軟正黑體","#000000"),(music_text=new createjs.Text("音樂：魔王魂","bold 15px 微軟正黑體","#000000")).x=canvas_width-music_text.getMeasuredWidth(),music_text.y=canvas_height-music_text.getMeasuredHeight(),loading_text.x=canvas_width/2-loading_text.getMeasuredWidth()/2,loading_text.y=canvas_height/2-loading_text.getMeasuredHeight()/2,stage.addChild(loading_text),stage.addChild(music_text),stage.update(),manifest=[{src:"/images/coolgame/sea.png",id:"sea"},{src:"/images/coolgame/fisherman.png",id:"fisherman"},{src:"/images/coolgame/background.png",id:"game_background"},{src:"/images/coolgame/fish1.png",id:"fish1"},{src:"/images/coolgame/fish2.png",id:"fish2"},{src:"/images/coolgame/fish3.png",id:"fish3"},{src:"/images/coolgame/fish4.png",id:"fish4"},{src:"/images/coolgame/bubble1.png",id:"bubble1"},{src:"/images/coolgame/bubble2.png",id:"bubble2"},{src:"/images/coolgame/bubble3.png",id:"bubble3"},{src:"/images/coolgame/bubble4.png",id:"bubble4"},{src:"/images/coolgame/bubble5.png",id:"bubble5"},{src:"/images/coolgame/bubble6.png",id:"bubble6"},{src:"/images/coolgame/bubble7.png",id:"bubble7"},{src:"/images/coolgame/bird1.png",id:"bird1"},{src:"/images/coolgame/fish_ad.png",id:"fish_ad"},{src:"/images/coolgame/harpoon.png",id:"harpoon"},{src:"/images/coolgame/score_background.png",id:"score_background"},{src:"/images/coolgame/rank_background.png",id:"rank_background"},{src:"/images/coolgame/sea.png",id:"score_sea"},{src:"/images/coolgame/haver.png",id:"haver"},{src:"/images/coolgame/questionboard1.png",id:"questionboard1"},{src:"/images/coolgame/questionboard2.png",id:"questionboard2"},{src:"/images/coolgame/questionboard3.png",id:"questionboard3"},{src:"/images/coolgame/questionboard4.png",id:"questionboard4"},{src:"/images/coolgame/time.png",id:"time"},{src:"/images/coolgame/sound_open.png",id:"sound_open"},{src:"/images/coolgame/sound_close.png",id:"sound_close"},{src:"/images/coolgame/back.png",id:"back"},{src:"/images/coolgame/back_haver.png",id:"back_haver"},{src:"/images/coolgame/rank_single.png",id:"rank_single"},{src:"/images/coolgame/rank_total.png",id:"rank_total"},{src:"/images/coolgame/leave.png",id:"leave"},{src:"/images/coolgame/bucket.png",id:"bucket"},{src:"/images/coolgame/score_board.png",id:"score_board"},{src:"/images/coolgame/dolphin.png",id:"dolphin"},{src:"/images/coolgame/rule1.png",id:"rule1"},{src:"/images/coolgame/rule2.png",id:"rule2"},{src:"/images/coolgame/food.png",id:"food"},{src:"/images/coolgame/close.png",id:"close"},{src:"/images/coolgame/close_haver.png",id:"close_haver"},{src:"/music/coolgame/LabbyBGM.mp3",id:"LabbyBGM"},{src:"/music/coolgame/GameBGM01.mp3",id:"GameBGM01"},{src:"/music/coolgame/GameBGM02.mp3",id:"GameBGM02"},{src:"/music/coolgame/RankBGM.mp3",id:"RankBGM"},{src:"/music/coolgame/catchfish01.mp3",id:"catchfish01"},{src:"/music/coolgame/catchfish02.mp3",id:"catchfish02"},{src:"/music/coolgame/catchfish03.mp3",id:"catchfish03"},{src:"/music/coolgame/catchfish04.mp3",id:"catchfish04"},{src:"/music/coolgame/catchbird.mp3",id:"catchbird"},{src:"/music/coolgame/catchdolphin.mp3",id:"catchdolphin"},{src:"/music/coolgame/correct.mp3",id:"correct"},{src:"/music/coolgame/wrong.mp3",id:"wrong"},{src:"/music/coolgame/shoot.mp3",id:"shoot"},{src:"/music/coolgame/DolphinBGM.mp3",id:"DolphinBGM"},{src:"/music/coolgame/QuestionBGM.mp3",id:"QuestionBGM"},{src:"/music/coolgame/alarm.mp3",id:"alarm"},{src:"/music/coolgame/bell.mp3",id:"bell"},{src:"/music/coolgame/game_end.mp3",id:"game_end"}],(loader=new createjs.LoadQueue(!0)).installPlugin(createjs.Sound),loader.on("fileload",handleFileLoad),loader.on("complete",handleComplete),loader.on("error",handleError),loader.loadManifest(manifest),load_question_data())}function handleFileLoad(e){done_loading||(complete_file_num++,loading_text.text=Math.floor(complete_file_num/manifest.length*100)+"%",loading_text.x=canvas_width/2-loading_text.getMeasuredWidth()/2,loading_text.y=canvas_height/2-loading_text.getMeasuredHeight()/2,stage.update())}var done_loading=!1;function handleComplete(){done_loading=!0,loading_text.text="點擊螢幕開始遊戲~",loading_text.x=canvas_width/2-loading_text.getMeasuredWidth()/2,loading_text.y=canvas_height/2-loading_text.getMeasuredHeight()/2,stage.update()}function handleError(){console.log("erreo")}function source_init(){var e={images:[loader.getResult("fish1")],frames:{width:461,height:368,regX:230,regY:189},animations:{normal:{frames:[0,1],speed:.1},special:{frames:[3,4],speed:.1},special_die:{frames:[5],speed:0},normal_die:{frames:[2],speed:0}}},t={images:[loader.getResult("fish2")],frames:{width:500,height:433,regX:250,regY:216},animations:{normal:{frames:[0,1],speed:.1},special:{frames:[3,4],speed:.1},special_die:{frames:[5],speed:0},normal_die:{frames:[2],speed:0}}},a={images:[loader.getResult("fish3")],frames:{width:547,height:357,regX:273,regY:178},animations:{normal:{frames:[0,1],speed:.1},special:{frames:[3,4],speed:.1},special_die:{frames:[5],speed:0},normal_die:{frames:[2],speed:0}}},n={images:[loader.getResult("fish4")],frames:{width:550,height:400,regX:275,regY:200},animations:{normal:{frames:[0,1],speed:.1},special:{frames:[3,4],speed:.1},special_die:{frames:[5],speed:0},normal_die:{frames:[2],speed:0}}},i={images:[loader.getResult("bird1")],frames:{width:318,height:273,regX:159,regY:136},animations:{normal:{frames:[0,1],speed:.1},normal_die:{frames:[2],speed:0}}},r={images:[loader.getResult("fish_ad")],frames:{width:798,height:190,regX:399,regY:95},animations:{normal:{frames:[0,1],speed:.1}}},o={images:[loader.getResult("dolphin")],frames:{width:548,height:220,regX:274,regY:110},animations:{normal:{frames:[0,1],speed:.1},normal_die:{frames:[2],speed:0}}};animalsource.push({type:0,score:1200,spritesheet:new createjs.SpriteSheet(i)}),animalsource.push({type:1,score:250,spritesheet:new createjs.SpriteSheet(e)}),animalsource.push({type:2,score:200,spritesheet:new createjs.SpriteSheet(t)}),animalsource.push({type:3,score:125,spritesheet:new createjs.SpriteSheet(a)}),animalsource.push({type:4,score:125,spritesheet:new createjs.SpriteSheet(n)}),animalsource.push({type:5,spritesheet:new createjs.SpriteSheet(r)}),animalsource.push({type:6,score:-1e4,spritesheet:new createjs.SpriteSheet(o)})}function create_back_container(){back_container=new createjs.Container;var e=new createjs.Bitmap(loader.getResult("back")),t=new createjs.Shape;e.scale=.4,e.y=12,e.x=7,back_container.visible=!1,t.graphics.beginFill("#FFFFFF").drawRect(7,12,e.getwidth(),e.getheight()),t.alpha=.01,t.addEventListener("mouseover",function(){e.image=loader.getResult("back_haver"),t.cursor="pointer"}),t.addEventListener("mouseout",function(){e.image=loader.getResult("back")}),t.addEventListener("mousedown",function(){now>=3?labby_init():(soundcontrol.BGM.paused=!0,close_game_event(),leave_container.visible=!0,stop=!0,question_time_stop=!0)}),back_container.addChild(e),back_container.addChild(t),stage.addChild(back_container)}function create_rule_container(){rule_container=new createjs.Container;var e=new createjs.Bitmap(loader.getResult("rule1")),t=new createjs.Bitmap(loader.getResult("rule2")),a=new createjs.Shape,n=new createjs.Bitmap(loader.getResult("close"));n.x=685,n.y=32,n.scale=.5,n.addEventListener("mouseover",function(e){e.target.cursor="pointer",n.image=loader.getResult("close_haver")}),n.addEventListener("mouseout",function(e){e.target.cursor="pointer",n.image=loader.getResult("close")}),n.addEventListener("mousedown",function(e){rule_close=!0,rule_container.visible=!1}),a.graphics.beginFill("#000000").drawCircle(718,261,24),a.alpha=.01,a.addEventListener("mouseover",function(e){e.target.cursor="pointer"}),a.addEventListener("mousedown",function(n){t.visible=!0,e.visible=!1,a.visible=!1,i.visible=!0});var i=new createjs.Shape;i.graphics.beginFill("#000000").drawCircle(70,255,24),i.visible=!1,i.alpha=.01,i.addEventListener("mouseover",function(e){e.target.cursor="pointer"}),i.addEventListener("mousedown",function(n){t.visible=!1,e.visible=!0,a.visible=!0,i.visible=!1}),e.x=13,t.x=13,e.scale=.65,t.scale=.65,t.visible=!1,rule_container.x=10,rule_container.addChild(e),rule_container.addChild(t),rule_container.addChild(a),rule_container.addChild(i),rule_container.addChild(n),rule_container.visible=!1,stage.addChild(rule_container)}function create_leave_container(){leave_container=new createjs.Container;var e=new createjs.Bitmap(loader.getResult("leave")),t=new createjs.Text("確定要離開遊戲嗎？","bold 24px "+font_family,"#000000");leave_container.visible=!1,e.scale=.7;var a=new createjs.Shape;a.graphics.beginFill("#000000").drawRect(0,0,800,500),a.alpha=.3,e.x=canvas_width/2-e.getwidth()/2,e.y=canvas_height/2-e.getheight()/2,t.y=e.y+40,t.x=e.x+108;var n=new createjs.Shape;n.alpha=.01;var r=new createjs.Text("含淚離開","Bold 20px 微軟正黑體","#000000");r.x=t.x+50,r.y=t.y+50,n.graphics.beginFill("#FFFFFF").drawRect(r.x,r.y,80,30);var o=r.getMeasuredWidth(),s=new createjs.Shape;s.graphics.s("#000000").mt(r.x,r.y+25).lt(r.x+o,r.y+25);var c=new createjs.Bitmap(loader.getResult("haver"));c.x=t.x,c.y=r.y,c.scale=.48;var l=new createjs.Shape;l.alpha=.01;var _=new createjs.Text("回心轉意","Bold 20px 微軟正黑體","#000000");_.x=t.x+50,_.y=t.y+100,l.graphics.beginFill("#FFFFFF").drawRect(_.x,_.y,80,30);o=_.getMeasuredWidth();var h=new createjs.Shape;h.graphics.s("#000000").mt(_.x,_.y+25).lt(_.x+o,_.y+25);var d=new createjs.Bitmap(loader.getResult("haver"));for(d.x=t.x,d.y=_.y,d.scale=.48,leavebutton_source.push({text:r,underline:s,haver:c}),leavebutton_source.push({text:_,underline:h,haver:d}),i=0;i<leavebutton_source.length;i++)leavebutton_source[i].haver.visible=!1,leavebutton_source[i].underline.visible=!1;n.addEventListener("mousedown",function(){leave_container.visible=!1,stage.removeChild(question_container),clearInterval(question_timer),stage.removeChild(score_catch_animal_container),close_movement(),clear_game_stage();for(var e=0;e<dolphin_list.length;e++)stage.removeChild(dolphin_list[e]);for(e=0;e<catch_fish.length;e++)catch_fish[e].visible=!1;labby_init()}),n.addEventListener("mouseover",function(){n.cursor="pointer",leavebutton_source[0].haver.visible=!0,leavebutton_source[0].underline.visible=!0}),n.addEventListener("mouseout",function(){leavebutton_source[0].haver.visible=!1,leavebutton_source[0].underline.visible=!1}),l.addEventListener("mousedown",function(){leave_container.visible=!1,1==now&&game_event(),soundcontrol.BGM.paused=muted,stop=!1,question_time_stop=!1}),l.addEventListener("mouseover",function(){l.cursor="pointer",leavebutton_source[1].haver.visible=!0,leavebutton_source[1].underline.visible=!0}),l.addEventListener("mouseout",function(){leavebutton_source[1].haver.visible=!1,leavebutton_source[1].underline.visible=!1}),leave_container.addChild(a),leave_container.addChild(e),leave_container.addChild(t),leave_container.addChild(r),leave_container.addChild(n),leave_container.addChild(s),leave_container.addChild(c),leave_container.addChild(_),leave_container.addChild(l),leave_container.addChild(h),leave_container.addChild(d),stage.addChild(leave_container)}function create_stage_element(){catch_animal_text=new createjs.Text(" X  0\n\n X  0\n\n X  0\n\n X  0","12px Arial","#000000"),background=new createjs.Bitmap(loader.getResult("game_background")),fisherman=new createjs.Bitmap(loader.getResult("fisherman")),sea=new createjs.Bitmap(loader.getResult("sea")),score_board=new createjs.Bitmap(loader.getResult("score_board")),bucket=new createjs.Bitmap(loader.getResult("bucket")),harpoon_text=new createjs.Text("Harpoon:10","18px Arial","#000000"),fish_ad=new createjs.Sprite(animalsource[5].spritesheet,"normal"),game_time_image=new createjs.Bitmap(loader.getResult("time")),question_container=new createjs.Container,createjs.Ticker.framerate=50,createjs.Ticker.addEventListener("tick",update),leavebutton_source=new Array,sound_shape=new createjs.Shape,soundbutton=new createjs.Bitmap(loader.getResult("sound_open")),(rank_container=new createjs.Container).visible=!1,soundbutton.scale=.4,soundbutton.x=canvas_width-soundbutton.getwidth(),soundbutton.y=canvas_height-soundbutton.getheight(),(score_board_text=new createjs.Text("0","bold 20px 微軟正黑體","#000000")).visible=!1,sound=!0,bucket.scale=.5,bucket.scaleX=.6,bucket.y=257,bucket.x=-0,bucket.visible=!1,score_board.visible=!1,sound_shape.graphics.beginFill("#FFFFFF").drawRect(canvas_width-soundbutton.getwidth(),canvas_height-soundbutton.getheight(),soundbutton.getwidth(),soundbutton.getheight()),sound_shape.alpha=.01,sound_shape.addEventListener("mousedown",function(e){sound?(soundbutton.image=loader.getResult("sound_close"),soundcontrol.BGM.paused=!0,muted=!0):(soundbutton.image=loader.getResult("sound_open"),soundcontrol.BGM.paused=!1,muted=!1),sound=1!=sound}),sound_shape.addEventListener("mouseover",()=>{sound_shape.cursor="pointer"}),stage.addChild(background),stage.addChild(fisherman),stage.addChild(sea),stage.addChild(score_board),stage.addChild(bucket),stage.addChild(soundbutton),stage.addChild(sound_shape),stage.addChild(fish_ad),stage.addChild(score_board_text),stage.addChild(question_end_container),stage.addChild(rank_container),create_rank_container(),create_back_container(),create_leave_container(),create_labbybutton(),create_question_end_container(),create_dolphin_container(),create_rule_container(),fisherman_harpoon=new harpoon}function init(){source_init(),create_stage_element(),labby_init()}function game_event(){stage.addEventListener("stagemousemove",mousemove),stage.addEventListener("mousedown",mousedown),document.onkeydown=keyDown,document.onkeyup=keyUp}function clear_animal(){for(i=0;i<animal_list.length;i++)animal_list[i].dic>0?createjs.Tween.get(animal_list[i]).to({x:canvas_width+110},1e3):createjs.Tween.get(animal_list[i]).to({x:-110},1e3);fish_ad.visible&&createjs.Tween.get(fish_ad).to({x:-450},1e3).call(()=>{close_fish_ad()})}function fish_jump(){for(i=0;i<catch_fish.length-1;i++)createjs.Tween.get(catch_fish[i]).wait(2e3).to({y:fisherman.y-getrandom(50)+20,x:fisherman.x+50-getrandom(50)},600);createjs.Tween.get(catch_fish[catch_fish.length-1]).wait(2e3).to({y:fisherman.y-getrandom(50)+20,x:fisherman.x+35-getrandom(50)},600).call(()=>{for(i=0;i<catch_fish.length;i++)stage.setChildIndex(catch_fish[i],2),createjs.Tween.get(catch_fish[i]).wait(500).to({x:30-Math.abs(fisherman.getwidth())-getrandom(50)},3500)})}function create_question_end_container(){var e=new Button_Text("回到大廳","bold 20px 微軟正黑體","#000000",0,0),t=new Button_Text("排行榜","bold 20px 微軟正黑體","#000000",200,0);(question_end_container=new createjs.Container).addChild(e),question_end_container.addChild(t),question_end_container.x=415,question_end_container.y=320,e.havermask.addEventListener("mousedown",function(){if(reach_close){question_end_container.visible=!1;for(var e=0;e<dolphin_list.length;e++)stage.removeChild(dolphin_list[e]);stage.removeChild(question_container),stage.removeChild(score_catch_animal_container),labby_init()}}),t.havermask.addEventListener("mousedown",function(){if(reach_close){question_end_container.visible=!1;for(var e=0;e<dolphin_list.length;e++)stage.removeChild(dolphin_list[e]);stage.removeChild(question_container),stage.removeChild(score_catch_animal_container),ranking_init()}}),question_end_container.visible=!1,stage.addChildAt(question_end_container,stage.numChildren-1)}function usergame_init(){$.ajax({url:"usergameinit",method:"get",success:()=>{},error:e=>{console.log(e)}})}function update_score(){$.ajax({url:"updatescore",method:"POST",data:{game_id:game_id,score:user_score},success:()=>{},error:e=>{console.log(e)}})}function question_end(){if(0==dolphin_list.length){stage.removeChild(question_container);var e=score_board_text.x-(score_board.x-512),t=score_board_text.y-(score_board.y-169);createjs.Tween.get(score_board).to({x:512,y:169,scale:.65},1e3).call(()=>{question_end_container.visible=!0}),createjs.Tween.get(score_board_text).to({x:e+19,y:t+13,scale:1.5},1e3).call(()=>{question_end_container.visible=!0,user_score+user.score_sum>=77777&&0==reach&&show_reach_animation()}),clearInterval(question_timer),clearInterval(score_update_timer),update_score()}else back_container.visible=!1,question_container.visible=!1,dolphin_container.alpha=0,createjs.Tween.get(dolphin_container).to({alpha:1},1500),dolphin_container.visible=!0,now=-1,BGM_change();now_score=user_score,score_board_text.text=(1==now?"Score:":"")+now_score,2==now&&(score_text_lenght!=score_board_text.text.length&&(score_text_lenght=score_board_text.text.length),score_board_text.x=score_board.getwidth()/2-score_board_text.getMeasuredWidth()/2-8-score_board_text.text.length,score_board_text.y=score_board.y+51.5-score_board_text.getMeasuredHeight()/2-3)}function create_questionboard(){if(board_index=0,catch_animal_num[1]>0)board_index=1;else if(catch_animal_num[2]>0)board_index=2;else if(catch_animal_num[3]>0)board_index=3;else{if(!(catch_animal_num[4]>0))return void question_end();board_index=4}if(4!=board_index||0==score_catch_animal_num[3]){for(question_index_list=new Array,i=0;i<question_list[board_index>=3?2:board_index-1].length;i++)question_index_list.push(i);for(i=0;i<5;i++)option[i].visible=!1}question_text.visible=!1;var e=new createjs.SpriteSheet({images:[loader.getResult("questionboard"+board_index)],frames:{width:1600,height:1e3,regX:0,regY:0},animations:{normal:{frames:[0],speed:0},correct:{frames:[1],speed:0}}});question_container.removeChild(questionboard),(questionboard=new createjs.Sprite(e,"normal")).scale=0,questionboard.x=score_catch_animal_container.children[board_index].x+score_catch_animal_container.x,questionboard.y=130,question_container.addChildAt(questionboard,1),createjs.Tween.get(questionboard).to({scale:.5,x:0,y:0},1e3).call(()=>{for(i=0;i<5;i++)option[i].visible=!0;question_text.visible=!0,next_question()})}function question_show(){var e=new Array,t=question.question.split("");for(question_text.text="Q：",i=0;i<t.length;i++)i%18==0&&0!=i?question_text.text+=t[i]+"\n       ":question_text.text+=t[i];for(question_text.text+=1==board_index?"(多選題)":"(單選題)",i=0;i<question.answer.length+question.option.length;i++)e.push(i);for(i=4;i>e.length-1;i--)option[i].visible=!1,option[i].ans=!1;for(i=0;i<question.answer.length;i++){var a=getrandom(e.length);option[e[a]].setText(String.fromCharCode(65+e[a])+" "+question.answer[i],!0),e=arrayRemove(e,e[a])}for(i=0;i<question.option.length;i++){a=getrandom(e.length);option[e[a]].setText(String.fromCharCode(65+e[a])+" "+question.option[i],!1),e=arrayRemove(e,e[a])}1==board_index?(question_time=21,question_time_text.text="20"):(question_time=11,question_time_text.text="10"),question_time_count=49,question_time_stop=!1,question_time_text.visible=!0,back_container.visible=!0}function next_question(){if(0==catch_animal_num[board_index]){question_time_text.visible=!1;for(var e=0;e<5;e++)option[e].visible=!1;question_text.visible=!1,back_container.visible=!1,createjs.Tween.get(questionboard).to({scale:0,x:score_catch_animal_container.children[board_index].x+score_catch_animal_container.x,y:130},1e3).call(()=>{create_questionboard()})}else{catch_animal_num[board_index]--;var t=getrandom(question_index_list.length);question=question_list[board_index>=3?2:board_index-1][question_index_list[t]],question_index_list=arrayRemove(question_index_list,question_index_list[t]),ans_num=question.answer.length,question_show()}}function load_question(){question_list.push(new Array),question_list.push(new Array),question_list.push(new Array);for(var e=0;e<question_data.length;e++){var t=question_data[e];question_list[t.Type].push(new Question(t.Type,t.Q,0==t.Op.length?new Array:t.Op.split(","),t.Ans.split(",")))}question_num=[0,0,0],question_index_list=new Array;for(e=0;e<3;e++)question_num[e]=question_list[e].length}function question_time_update(){question_time_stop||(question_time_count+=1)%50==0&&(1==question_time&&show_correct(),question_time--,question_time_text.text=question_time+"")}function question_init(){question_container=new createjs.Container;var e=new createjs.Shape;(question_text=new createjs.Text("","Bold 20px "+font_family,"#000000")).x=190,question_text.y=140,question_time_count=0,(question_time_text=new createjs.Text("10","bold 30px Arial","#000000")).x=canvas_width/2-10,question_time_text.y=question_text.y-50,question_time_text.visible=!1,question_timer=setInterval(question_time_update,20),e.graphics.beginFill("#000000").drawRect(0,0,800,500),e.alpha=.2,question_container.addChild(e),question_container.addChild(question_text),question_container.addChild(question_time_text),option=new Array,question_num=[0,0,0],question_index_list=new Array;for(var t=0;t<3;t++)question_num[t]=question_list[t].length;for(i=0;i<5;i++)option.push(new Option),question_container.addChild(option[i]);option[1].x=option[0].x+185,option[2].y=option[0].y+40,option[3].x=option[0].x+185,option[3].y=option[0].y+40,option[4].y=option[0].y+80,BGM_change(),create_questionboard(),stage.addChild(question_container),stage.setChildIndex(back_container,stage.numChildren-1),stage.setChildIndex(leave_container,stage.numChildren-1)}function clear_game_stage(){stage.removeChild(start_time_text),stage.removeChild(harpoon_text),stage.removeChild(countdown_text),stage.removeChild(catch_animal_container),stage.removeChild(game_time_image),clear_harpoon()}function close_movement(){clearInterval(countdown_timer),gamestart=!1,clese_bird(),clese_fish(),clese_bubble(),clear_animal(),close_game_event(),close_fishmanwalk()}function create_dolphin_container(){dolphin_container=new createjs.Container;var e=new createjs.Text("粉紅色海豚名為「中華白海豚」依《野生\r\n\r\n動物保育法》公告之保育類野生動物名錄\r\n\r\n，已將中華白海豚列入瀕臨絕種的極度危\r\n\r\n險等級(CR)，讓我們一起守護可愛海豚，\r\n\r\n所以不要用任何方式獵殺海豚歐~魚叉也\r\n\r\n算，扣你10000分作為警惕。","bold 20px 標楷體","#000000");e.x=218,e.y=145;var t=new createjs.Shape;t.graphics.beginFill("#000000").drawRect(0,0,800,500),t.alpha=.2;var a=new createjs.Shape;a.graphics.beginFill("#FFFFFF").drawRoundRect(200,125,400,250,10),a.alpha=1;var n=new Button_Text("海豚對不起我知道錯了","bold 20px 微軟正黑體","#000000",250,325);n.haver_background.graphics.beginFill("#FFA1B4").drawRoundRect(37,-6,224,34,10),n.havermask.graphics.beginFill("#34AEC7").drawRoundRect(37,-6,224,34,10),dolphin_container.addChild(t),dolphin_container.addChild(a),dolphin_container.addChild(e),dolphin_container.addChild(n),dolphin_container.visible=!1,n.addEventListener("mousedown",function(e){stage.removeChild(question_container),user_score+=animalsource[6].score,now_score=user_score,score_board_text.text=(1==now?"Score:":"")+now_score,2==now&&(score_text_lenght!=score_board_text.text.length&&(score_text_lenght=score_board_text.text.length),score_board_text.x=score_board.getwidth()/2-score_board_text.getMeasuredWidth()/2-8-score_board_text.text.length-10,score_board_text.y=score_board.y+51.5-score_board_text.getMeasuredHeight()/2-3);var t=score_board_text.x-(score_board.x-512),a=score_board_text.y-(score_board.y-169);createjs.Tween.get(score_board).to({x:512,y:169,scale:.65},1e3).call(()=>{question_end_container.visible=!0}),createjs.Tween.get(score_board_text).to({x:t+19,y:a+13,scale:1.5},1e3).call(()=>{question_end_container.visible=!0,user_score+user.score_sum>=77777&&0==reach&&show_reach_animation()}),dolphin_container.visible=!1,clearInterval(question_timer),new Score_Text(""+animalsource[6].score,"bold 30px Arial","#000000",score_board.getwidth()/2+score_board.x,score_board_text.y),update_score()}),stage.addChild(dolphin_container)}function game_end(){close_movement(),gamestart=!1,0!=catch_fish.length&&fish_jump(),soundcontrol.BGM.stop(),back_container.visible=!1,start_time_text.text="Time's up！",muted||createjs.Sound.play("game_end"),start_time_text.x-=40,stage.addChild(start_time_text),fisherman_harpoon.scaleX*=fisherman_harpoon.scaleX<0?-1:1,fisherman_harpoon.rotation=35,fisherman.scaleX*=fisherman.scaleX<0?-1:1,fisherman_harpoon.revise_position(),createjs.Tween.get(fisherman_harpoon).wait(3100).to({x:-Math.abs(fisherman.getwidth())+25*(fisherman.scaleX<0?1:-1)},3500),createjs.Tween.get(fisherman).wait(3100).to({x:-Math.abs(fisherman.getwidth())},3500).call(()=>{clear_game_stage(),clear_harpoon(),score_init()})}function countdown(){stop||(countdown_time--,countdown_text.text=""+countdown_time,0==countdown_time&&game_end())}function clear_harpoon(){for(i=0;i<harpoon_list.length;i++)stage.removeChild(harpoon_list[i])}var num_score_fish=0;function score_init(){for(now=2,background.image=loader.getResult("score_background"),num_score_fish=0,sea.y=270,sea.alpha=.45,fisherman.y=380,score_board.scale=.5,score_board.y=140,score_board.x=0,score_catch_animal_num=[0,0,0,0,0],fisherman.scale=fisherman_harpoon.scale=.2496,fisherman.x=canvas_width+fisherman.getwidth(),fisherman_harpoon.rotation=35,fisherman_harpoon.revise_position(),stage.setChildIndex(fisherman,1),stage.setChildIndex(fisherman_harpoon,2),stage.setChildIndex(bucket,1),stage.setChildIndex(score_board,1),bucket.visible=!0,score_board.visible=!0,score_board_text.scale=1.4,score_board_text.rotation=-4.5,score_board_text.text=user_score+"",score_board_text.x=score_board.getwidth()/2-score_board_text.getMeasuredWidth()/2-8-score_board_text.text.length,score_board_text.y=score_board.y+51.5-score_board_text.getMeasuredHeight()/2-3,bucket.y=257,bucket.x=-0,score_board.y=140,i=0;i<catch_fish.length;i++)catch_fish[i].scale*=1.56,catch_fish[i].alpha=1,stage.setChildIndex(catch_fish[i],3),catch_fish[i].y=fisherman.y-1.56*getrandom(50)+20*1.56,catch_fish[i].x=fisherman.x+1.56*(35-getrandom(50)),createjs.Tween.get(catch_fish[i]).to({x:255+1.56*(50-getrandom(50))},3500);var e=0;createjs.Tween.get(fisherman).to({x:255},3500),createjs.Tween.get(fisherman_harpoon).to({x:255+40*(fisherman.scaleX<0?1:-1)},3500).call(()=>{create_score_catch_animal_container(),createjs.Tween.get(fisherman).wait(1e3).call(()=>{for(i=0;i<catch_fish.length;i++)0!=catch_fish[i].animaltype?6!=catch_fish[i].animaltype||(dolphin_list.push(catch_fish[i]),catch_fish=arrayRemove(catch_fish,catch_fish[i]),i--):(e++,createjs.Tween.get(catch_fish[i]).wait(200*e).to({y:220,x:380},600).wait(600).to({y:bucket.y+10,x:bucket.x+bucket.getwidth()/2},600).to({visible:!1}).call(()=>{if(e--,muted||createjs.Sound.play("bell"),new Score_Text("+"+animalsource[0].score,"bold 20px 微軟正黑體","#000000",bucket.x+bucket.getwidth()/2,bucket.y+10),user_score+=animalsource[0].score,0==e)if(0!=catch_fish.length){var t=2e3/catch_fish.length;for(i=0;i<catch_fish.length;i++)createjs.Tween.get(catch_fish[i]).wait(t*i).to({visible:!1,x:score_catch_animal_container.children[catch_fish[i].animaltype].x+score_catch_animal_container.x,y:score_catch_animal_container.children[catch_fish[i].animaltype].y+score_catch_animal_container.y},599).call(()=>{score_catch_animal_num[catch_fish[num_score_fish++].animaltype]++,muted||createjs.Sound.play("alarm"),score_catch_animal_text_update()})}else question_end()}),catch_fish=arrayRemove(catch_fish,catch_fish[i]),i--);if(0==catch_animal_num[0])if(0!=catch_fish.length){var t=2e3/catch_fish.length;for(i=0;i<catch_fish.length;i++)createjs.Tween.get(catch_fish[i]).wait(t*i).to({visible:!1,x:score_catch_animal_container.children[catch_fish[i].animaltype].x+score_catch_animal_container.x,y:score_catch_animal_container.children[catch_fish[i].animaltype].y+score_catch_animal_container.y},599).call(()=>{score_catch_animal_num[catch_fish[num_score_fish++].animaltype]++,muted||createjs.Sound.play("alarm"),score_catch_animal_text_update()})}else question_end()})})}function create_game_timer(){countdown_time=game_time,(countdown_text=new createjs.Text(game_time+"","30px Arial","#000000")).x=canvas_width/2-10,countdown_text.y=20,countdown_timer=setInterval(countdown,1e3),stage.addChild(countdown_text)}function catech_animal_update(){catch_animal_text.text=" X  "+catch_animal_num[1]+"\n\n X  "+catch_animal_num[2]+"\n\n X  "+catch_animal_num[3]+"\n\n X  "+catch_animal_num[4]}function create_catch_animal_container(){catch_animal_text.text=" X  0\n\n X  0\n\n X  0\n\n X  0",catch_animal_text.x=25,catch_animal_text.y=-5,catch_animal_num=[0,0,0,0,0],catch_animal_container=new createjs.Container;var e=new createjs.Sprite(animalsource[1].spritesheet,"normal_die"),t=new createjs.Sprite(animalsource[2].spritesheet,"normal_die"),a=new createjs.Sprite(animalsource[3].spritesheet,"normal_die"),n=new createjs.Sprite(animalsource[4].spritesheet,"normal_die");e.scale=.08,t.scale=.08,a.scale=.08,n.scale=.08,catch_animal_container.addChild(e),catch_animal_container.addChild(t),catch_animal_container.addChild(a),catch_animal_container.addChild(n),catch_animal_container.addChild(catch_animal_text),stage.addChildAt(catch_animal_container,1),t.y=e.y+23,a.y=t.y+23,n.y=a.y+23,catch_animal_container.x=canvas_width-70,catch_animal_container.y=50}function score_catch_animal_text_update(){score_catch_animal_text.text="  X  "+(score_catch_animal_num[1]>=10?score_catch_animal_num[1]+"":score_catch_animal_num[1]+"  ")+"                       X  "+(score_catch_animal_num[2]>=10?score_catch_animal_num[2]+"":score_catch_animal_num[2]+"  ")+"                           X  "+(score_catch_animal_num[3]>=10?score_catch_animal_num[3]+"":score_catch_animal_num[3]+"  ")+"                        X  "+score_catch_animal_num[4],num_score_fish==catch_fish.length&&question_init()}function create_score_catch_animal_container(){(score_catch_animal_text=new createjs.Text("  X  0                         X  0                             X  0                          X  0","18px Arial","#000000")).x=25,score_catch_animal_text.y=-5,score_catch_animal_container=new createjs.Container;var e=new createjs.Sprite(animalsource[1].spritesheet,"normal_die"),t=new createjs.Sprite(animalsource[2].spritesheet,"normal_die"),a=new createjs.Sprite(animalsource[3].spritesheet,"normal_die"),n=new createjs.Sprite(animalsource[4].spritesheet,"normal_die");e.scale=.1872,t.scale=.1872,a.scale=.1872,n.scale=.1872,score_catch_animal_container.addChild(score_catch_animal_text),score_catch_animal_container.addChild(e),score_catch_animal_container.addChild(t),score_catch_animal_container.addChild(a),score_catch_animal_container.addChild(n),stage.addChild(score_catch_animal_container),t.x=e.x+150,a.x=t.x+170,n.x=a.x+165,score_catch_animal_container.x=155,score_catch_animal_container.y=100}function create_harpoon_text(){harpoon_text.x=canvas_width-110,harpoon_text.y=20,stage.addChild(harpoon_text)}function create_game_time_image(){game_time_image.x=canvas_width/2-48,game_time_image.y=12.5,game_time_image.scale=.345,stage.addChild(game_time_image)}function create_score_board_update(){score_board_text.scale=1,score_board_text.rotation=0,score_board_text.text="Score:0",score_board_text.visible=!0,score_board_text.x=back_container.x+50,score_board_text.y=harpoon_text.y,score_update_timer=setInterval(score_text_update,10)}var score_text_lenght=0;function score_text_update(){user_score!=now_score&&(v=Math.floor((user_score-now_score)/250+(now_score>user_score?-2:2)),Math.abs(now_score-user_score)<Math.abs(v)?now_score=user_score:now_score+=v,2==now&&(score_text_lenght!=score_board_text.text.length&&(score_text_lenght=score_board_text.text.length),score_board_text.x=score_board.getwidth()/2-score_board_text.getMeasuredWidth()/2-8-score_board_text.text.length,score_board_text.y=score_board.y+51.5-score_board_text.getMeasuredHeight()/2-3),score_board_text.text=(1==now?"Score:":"")+now_score)}function game_start(){gamestart=!0,back_container.visible=!0,harpoon_update(),create_game_time_image(),create_harpoon_text(),create_catch_animal_container(),create_game_timer(),create_score_board_update(),game_event(),open_bubble(),open_fish(),open_bird(),$.ajax({url:"startgame",method:"GET",error:e=>{console.log("err")},success:function(e){game_id=e.game_id}}),BGM_change()}function game_init(){now=1,clese_bird(),clese_fish(),clear_animal(),clese_bubble(),soundcontrol.BGM.stop(),dolphin_list=new Array,show_catch_animal_num=[0,0,0,0,0],catch_animal_num=[0,0,0,0,0],harpoon_list=new Array,animal_list=new Array,catch_fish=new Array,(start_time_text=new createjs.Text("3","40px Arial","#000000")).x=canvas_width/2-10,start_time_text.y=200,start_time_text.alpha=0,stage.addChild(start_time_text),createjs.Tween.get(start_time_text).wait(1e3).to({alpha:1},1e3).to({text:"2"}).to({alpha:0}).to({alpha:1},1e3).to({text:"1"}).to({alpha:0}).to({alpha:1},1e3).to({x:360,text:"Start！"}).wait(1e3).call(()=>{stage.removeChild(start_time_text),game_start()})}function close_fishmanwalk(){clearInterval(fishman_walk)}function open_fishmanwalk(){fishman_walk=setInterval(()=>{stop||(fisherman.scaleX<0?(fisherman.x+=.5,fisherman_harpoon.x=fisherman.x+25):(fisherman.x-=.5,fisherman_harpoon.x=fisherman.x-25),(fisherman.x+75>=canvas_width||fisherman.x<75)&&(fisherman.scaleX*=-1,fisherman_harpoon.rotation*=-1))},20)}function close_game_event(){stage.removeEventListener("stagemousemove",mousemove),stage.removeEventListener("mousedown",mousedown),document.onmousedown=null,document.onkeydown=null,document.onkeyup=null}function open_fish_ad(){fish_ad.visible=!0,stage.setChildIndex(fish_ad,stage.numChildren-2),fish_ad.y=400,fish_ad.x=canvas_width+300,fish_ad.scale=.5,generate_fish_ad=setInterval(function(){fish_ad.x-=2,fish_ad.x<=-300&&(fish_ad.x=canvas_width+250)},20)}function close_fish_ad(){fish_ad.visible=!1,clearInterval(generate_fish_ad)}function clese_bubble(){clearInterval(generate_bubble)}function clese_fish(){clearInterval(generate_fish)}function clese_bird(){clearInterval(generate_bird)}function labbybutton_mouseover(e){labbybutton_source[e].haver.visible=!0,labbybutton_source[e].underline.visible=!0}function labbybutton_mouseout(e){labbybutton_source[e].haver.visible=!1,labbybutton_source[e].underline.visible=!1}var at,bt,labbybutton_source=new Array;function create_labbybutton(){labbybutton_container=new createjs.Container;var e=new Button_Text("開始遊戲","bold 20px 微軟正黑體","#000000",0,0),t=new Button_Text("規則說明","bold 20px 微軟正黑體","#000000",0,55),a=new Button_Text("排行榜","bold 20px 微軟正黑體","#000000",10,110);e.havermask.addEventListener("mousedown",function(e){rule_close&&(labbybutton_container.visible=!1,game_init())}),a.havermask.addEventListener("mousedown",function(){rule_close&&(labbybutton_container.visible=!1,ranking_init())}),t.havermask.addEventListener("mousedown",function(e){rule_close&&(rule_close=!1,rule_container.visible=!0,e.target.parent.havermask.cursor="defult",e.target.parent.haver.visible=!1,e.target.parent.haver_background.alpha=.4)}),stage.enableMouseOver(100),labbybutton_container.addChild(e),labbybutton_container.addChild(t),labbybutton_container.addChild(a),labbybutton_container.x=325,labbybutton_container.y=200,stage.addChild(labbybutton_container)}function get_totalrank(){now=4,$.ajax({url:"gettotalrank",method:"GET",error:e=>{console.log(e)},success:function(e){rank_user_list=e,update_rank()}})}function get_highrank(){now=3,$.ajax({url:"gethighrank",method:"GET",error:e=>{console.log(e)},success:function(e){rank_user_list=e,update_rank()}})}function update_rank(){rank_container.children[3].image=null,rank_container.children[4].image=null,rank_container.children[5].image=null;var e=new createjs.Bitmap(0==(3==now?rank_user_list[0].score_high:rank_user_list[0].score_sum)?"":"/personal/profile-photo/"+rank_user_list[0].avatar);e.image.onload=(()=>{rank_container.children[3].image=e.image,rank_container.children[3].scale=1/((rank_container.children[3].image.width>rank_container.children[3].image.height?rank_container.children[3].image.width:rank_container.children[3].image.height)/80),rank_container.children[3].x=205+(80-rank_container.children[3].getwidth())/2,rank_container.children[3].y=110+(80-rank_container.children[3].getheight())/2,rank_container.children[4].x=100+(80-rank_container.children[4].getwidth())/2,rank_container.children[4].y=170+(80-rank_container.children[4].getheight())/2,rank_container.children[5].x=310+(80-rank_container.children[5].getwidth())/2,rank_container.children[5].y=200+(80-rank_container.children[5].getheight())/2,stage.update()});var t=new createjs.Bitmap(0==(3==now?rank_user_list[1].score_high:rank_user_list[1].score_sum)?"":"/personal/profile-photo/"+rank_user_list[1].avatar);t.image.onload=(()=>{rank_container.children[4].image=t.image,rank_container.children[4].scale=1/((rank_container.children[4].image.width>rank_container.children[4].image.height?rank_container.children[4].image.width:rank_container.children[4].image.height)/80),rank_container.children[3].x=205+(80-rank_container.children[3].getwidth())/2,rank_container.children[3].y=110+(80-rank_container.children[3].getheight())/2,rank_container.children[4].x=100+(80-rank_container.children[4].getwidth())/2,rank_container.children[4].y=170+(80-rank_container.children[4].getheight())/2,rank_container.children[5].x=310+(80-rank_container.children[5].getwidth())/2,rank_container.children[5].y=200+(80-rank_container.children[5].getheight())/2,stage.update()});var a=new createjs.Bitmap(0==(3==now?rank_user_list[2].score_high:rank_user_list[2].score_sum)?"":"/personal/profile-photo/"+rank_user_list[2].avatar);a.image.onload=(()=>{rank_container.children[5].image=a.image,rank_container.children[5].scale=1/((rank_container.children[5].image.width>rank_container.children[5].image.height?rank_container.children[5].image.width:rank_container.children[5].image.height)/80),rank_container.children[3].x=205+(80-rank_container.children[3].getwidth())/2,rank_container.children[3].y=110+(80-rank_container.children[3].getheight())/2,rank_container.children[4].x=100+(80-rank_container.children[4].getwidth())/2,rank_container.children[4].y=170+(80-rank_container.children[4].getheight())/2,rank_container.children[5].x=310+(80-rank_container.children[5].getwidth())/2,rank_container.children[5].y=200+(80-rank_container.children[5].getheight())/2,stage.update()});for(var n=0;n<rank_user_list.length;n++)if(0!=(3==now?rank_user_list[n].score_high:rank_user_list[n].score_sum)){var i=rank_user_list[n].name.split("");rank_name_text[n].text=1==i.length?"O":2==i.length?i[0]+"O":i[0]+"O"+i[i.length-1],rank_score_text[n].text=(n>2?"分數:":"")+(3==now?rank_user_list[n].score_high:rank_user_list[n].score_sum)}else rank_name_text[n].text="",rank_score_text[n].text="";rank_name_text[0].x=245-rank_name_text[0].getMeasuredWidth()/2,rank_score_text[0].x=245-rank_score_text[0].getMeasuredWidth()/2,rank_name_text[1].x=140-rank_name_text[1].getMeasuredWidth()/2,rank_score_text[1].x=140-rank_score_text[1].getMeasuredWidth()/2,rank_name_text[2].x=350-rank_name_text[2].getMeasuredWidth()/2,rank_score_text[2].x=350-rank_score_text[2].getMeasuredWidth()/2}function show_reach_animation(){reach_conrainer=new createjs.Container,stage.addChild(reach_conrainer);var e=new Array,t=new createjs.Shape,a=new createjs.Text("大","Bold 20px 微軟正黑體","#FFFFFF"),n=new createjs.Text("豐","Bold 20px 微軟正黑體","#FFFFFF"),i=new createjs.Text("收","Bold 20px 微軟正黑體","#FFFFFF");t.graphics.beginFill("#000000").drawRect(0,0,800,500),t.alpha=0;var r=new createjs.Bitmap(loader.getResult("food")),o=new createjs.Shape,s=new createjs.Text("恭喜獲得生活知能時數 1小時！！！","bold 20px 微軟正黑體","#FFFFFF");reach_close=!1,r.visible=!1,reach_conrainer.addChild(t),createjs.Tween.get(t).to({alpha:.7},800).call(function(){r.scale=.47,r.x=canvas_width/2-r.getwidth()/2,r.y=600;for(var t=0;t<150;t++){var c=new fish(getrandom(4)+1,!1);c.rotation=getrandom(180)-180,c.gotoAndStop("normal_die"),reach_conrainer.addChild(c),c.x=getrandom(700)+50,c.scale=.2,c.y=-100,createjs.Tween.get(c).wait(30*t).to({y:500-t/15*30,scale:.5},300-t/15*17),e.push(c)}a.shadow=new createjs.Shadow("#000000",5,6,1),a.x=120,a.y=30,a.scale=.1,reach_conrainer.addChild(a),n.shadow=new createjs.Shadow("#000000",5,5,1),n.x=a.x+200,n.y=30,n.scale=.1,reach_conrainer.addChild(n),i.shadow=new createjs.Shadow("#000000",5,5,1),i.x=n.x+200,i.y=30,i.scale=.1,reach_conrainer.addChild(i),reach_conrainer.addChild(r),createjs.Tween.get(r).wait(5101.133333333333).to({visible:!0}).to({y:canvas_height/2-r.getheight()/2-100},1e3).to({y:canvas_height/2-r.getheight()/2+100},1e3).to({y:canvas_height/2-r.getheight()/2+50},1e3).call(function(){createjs.Tween.get(a).to({scale:6},600).call(function(){createjs.Tween.get(n).to({scale:6},600).call(function(){createjs.Tween.get(i).to({scale:6},600).call(function(){o.graphics.beginFill("#000000").drawRoundRect(r.x+150-200+3,r.y+283,385,50,10),o.alpha=0,s.x=r.x+150-200+33+3,s.y=r.y+298,s.alpha=0,reach_conrainer.addChild(o),reach_conrainer.addChild(s),createjs.Tween.get(o).wait(300).to({alpha:.8},1e3),createjs.Tween.get(s).wait(300).to({alpha:1},1e3).call(function(){r.addEventListener("mousedown",function(e){createjs.Tween.get(reach_conrainer).to({alpha:0},1e3).call(function(){stage.removeChild(reach_conrainer),reach_close=!0})}),r.addEventListener("mouseover",function(e){r.cursor="pointer"}),createjs.Tween.get(r).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600).to({scale:.49},600).to({scale:.45},600)})})})})})})}function create_rank_container(){rank_name_text=new Array,rank_score_text=new Array,(rank_background=new createjs.Bitmap(loader.getResult("rank_single"))).scale=.65,rank_background.x=30,rank_background.y=20;var e=new createjs.Shape;e.graphics.beginFill("#34AEC7").drawRoundRect(48,38,153,31,5,0,0,0),e.alpha=.01,e.addEventListener("mousedown",function(e){rank_background.image=loader.getResult("rank_single"),now=3,get_highrank()}),e.addEventListener("mouseover",function(e){e.target.cursor="pointer"});var t=new createjs.Shape;t.graphics.beginFill("#000000").drawRoundRect(203,38,153,31,5,0,0,0),t.alpha=.01,t.addEventListener("mousedown",function(e){now=4,get_totalrank(),rank_background.image=loader.getResult("rank_total")}),t.addEventListener("mouseover",function(e){e.target.cursor="pointer"});var a=new createjs.Shape;a.graphics.beginFill("red").drawCircle(245,150,40);var n=new createjs.Bitmap("");n.mask=a,n.x=205,n.y=110;var i=new createjs.Shape;i.graphics.beginFill("red").drawCircle(140,210,40);var r=new createjs.Bitmap("");r.mask=i,r.x=100,r.y=170;var o=new createjs.Shape;o.graphics.beginFill("red").drawCircle(350,240,40);var s=new createjs.Bitmap("");s.mask=o,s.x=310,s.y=200,rank_container.addChild(rank_background),rank_container.addChild(e),rank_container.addChild(t),rank_container.addChild(n),rank_container.addChild(r),rank_container.addChild(s);for(var c=0;c<10;c++)rank_score_text.push(new createjs.Text("","bold 20px 微軟正黑體","#000000")),rank_container.addChild(rank_score_text[c]);for(c=0;c<10;c++)rank_name_text.push(new createjs.Text("","bold 20px 微軟正黑體","#000000")),rank_container.addChild(rank_name_text[c]);rank_name_text[0].x=n.x,rank_name_text[0].y=n.y-30,rank_name_text[1].x=r.x,rank_name_text[1].y=r.y-30,rank_name_text[2].x=s.x,rank_name_text[2].y=s.y-30,rank_score_text[0].x=n.x,rank_score_text[0].y=n.y+87,rank_score_text[1].x=r.x,rank_score_text[1].y=r.y+87,rank_score_text[2].x=s.x,rank_score_text[2].y=s.y+87;for(c=3;c<10;c++)rank_name_text[c].x=485,rank_name_text[c].y=120+51*(c-3),rank_score_text[c].x=568,rank_score_text[c].y=120+51*(c-3)}function ranking_init(){background.image=loader.getResult("rank_background"),back_container.visible=!0,fisherman.visible=!1,fisherman_harpoon.visible=!1,bucket.visible=!1,score_board.visible=!1,score_board_text.visible=!1,sea.visible=!1,now=3,BGM_change();for(var e=0;e<animal_list.length;e++)animal_list[e].visible=!1;close_fishmanwalk(),close_fish_ad(),clese_bird(),clese_fish(),clear_animal(),clese_bubble(),rank_container.visible=!0,get_highrank()}var resumeAudioContext=function(){try{createjs.WebAudioPlugin.context&&"suspended"===createjs.WebAudioPlugin.context.state&&createjs.WebAudioPlugin.context.resume()}catch(e){console.error("There was an error while trying to resume the SoundJS Web Audio context..."),console.error(e)}done_loading&&(window.removeEventListener("click",resumeAudioContext),stage.removeChild(loading_text),stage.removeChild(music_text),init())};function BGM_change(){null!=soundcontrol.BGM&&soundcontrol.BGM.stop(),0==now?soundcontrol.BGM=createjs.Sound.play("LabbyBGM",(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,loop:-1,volume:.7,duration:112e4})):1==now?1==getrandom(2)?soundcontrol.BGM=createjs.Sound.play("GameBGM01",(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,volume:.6,startTime:6e3,duration:46e4})):soundcontrol.BGM=createjs.Sound.play("GameBGM02",(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,volume:.7})):now>=3?soundcontrol.BGM=createjs.Sound.play("RankBGM",(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,volume:.9,loop:-1})):-1==now?soundcontrol.BGM=createjs.Sound.play("DolphinBGM",(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,volume:.6,loop:-1})):2==now&&(soundcontrol.BGM=createjs.Sound.play("QuestionBGM",(new createjs.PlayPropsConfig).set({interrupt:createjs.Sound.INTERRUPT_ANY,volume:.6,loop:-1}))),soundcontrol.BGM.paused=muted}function labby_init(){usergame_init(),getuser(),now=0,BGM_change(),gamestart=!1,close_game_event(),clese_bird(),clese_fish(),clese_bubble(),clearInterval(score_update_timer),stage.setChildIndex(sea,1),stage.setChildIndex(fisherman,1),user_score=0,now_score=0,rank_container.visible=!1,fisherman.visible=!0,bucket.visible=!1,score_board.visible=!1,score_board_text.visible=!1,fisherman_harpoon.visible=!0,sea.visible=!0,stop=!1,back_container.visible=!1,harpoon_list=new Array,animal_list=new Array,bubble_list=new Array,background.image=loader.getResult("game_background"),background.scale=.5,fisherman.scale=.16,fisherman_harpoon.scale=.16,fisherman.x=75,fisherman.y=canvas_seaheight-25,fisherman.regX=fisherman.image.width/2,fisherman.regY=fisherman.image.height/2,fisherman_harpoon.rotation=35,fisherman_harpoon.x=fisherman.x+25*(fisherman.scaleX<0?1:-1),fisherman_harpoon.y=fisherman.y-5,sea.scale=.5,sea.alpha=.3,sea.x=0,sea.y=0,labbybutton_container.visible=!0,dolphin_container.visible=!1,open_fishmanwalk(),open_fish_ad(),open_fish(),open_bubble(),open_bird()}